# Prometheus Configuration for Torrent VPN Stack Monitoring

global:
  scrape_interval: 15s  # How often to scrape targets
  evaluation_interval: 15s  # How often to evaluate rules
  scrape_timeout: 10s
  external_labels:
    monitor: 'torrent-vpn-stack'
    environment: 'home-lab'

# Alertmanager configuration (optional - for future alerting)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - 'alertmanager:9093'

# Rule files (optional - for future alerting rules)
# rule_files:
#   - '/etc/prometheus/rules/*.yml'

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          component: 'monitoring'

  # Gluetun VPN metrics (HTTP API endpoints)
  - job_name: 'gluetun'
    metrics_path: '/v1/publicip/ip'
    scrape_interval: 30s  # Check VPN IP less frequently
    static_configs:
      - targets: ['gluetun:8000']
        labels:
          service: 'gluetun'
          component: 'vpn'
    # Note: Gluetun's HTTP API returns JSON, not Prometheus metrics
    # We're scraping it to monitor availability, not for metrics
    # Consider using a custom exporter for rich Gluetun metrics

  # qBittorrent metrics (via exporter)
  - job_name: 'qbittorrent'
    scrape_interval: 15s
    static_configs:
      - targets: ['gluetun:17871']  # qbittorrent-exporter runs on gluetun network
        labels:
          service: 'qbittorrent'
          component: 'torrent-client'
    # qBittorrent exporter exposes metrics at :17871/metrics

  # cAdvisor - Container resource metrics
  - job_name: 'cadvisor'
    scrape_interval: 15s
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          service: 'cadvisor'
          component: 'container-metrics'
    # cAdvisor exposes metrics at :8080/metrics
    # Provides CPU, memory, network, disk metrics for all containers
